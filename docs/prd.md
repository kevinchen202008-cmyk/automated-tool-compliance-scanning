---
title: 工具合规扫描 Agent 服务 PRD
version: 0.1.0
status: draft
date: 2026-02-06
author: Product Manager (BMAD)
---

## 1. 背景与目标

### 1.1 背景
随着企业数字化程度不断提升，开发工具、CI/CD平台、第三方组件和开源软件大量涌入开发流程，工具使用的**合规性**（安全、许可证、政策、行业标准）日益成为审计和监管重点。目前大部分企业：

- 依赖人工或零散脚本进行工具合规检查
- 缺乏统一的工具资产视图与合规评分机制
- 难以在审计时给出可追溯的工具合规报告

### 1.2 产品目标
构建一个**基于 AI 的工具合规扫描 Agent Web 服务**，通过「输入工具名或工具名列表 → 自动输出结构化合规报告」的方式：

- 帮助企业快速评估现有/候选工具的合规风险
- 降低安全与审计团队的人力成本
- 为工具选型与治理提供量化依据

### 1.3 成功标准（业务视角）
- 合规检查覆盖率 > 95%
- 人工审查工作量减少 > 70%
- 工具有明确合规评分与结论，可在审计中直接引用

---

## 2. 范围（Scope）

### 2.1 In Scope（本期范围）
- 基于**工具名称/工具名列表**的合规扫描
- 生成包含以下字段的工具合规报告：
  - 工具名称
  - 工具版本（如可获取）
  - 工具合规性评分（量化得分）
  - 工具合规性建议
  - 工具合规性参考（相关标准/文档/链接）
  - 关键结论：是否合规；如不合规则给出原因和**开源替代建议**
- Web 服务形态（浏览器访问），支持：
  - 本地 WSL 部署
  - 公有云部署（阿里云/腾讯云/华为云等）
- AI 大模型调用：
  - 默认使用 GLM 官方 Open API（在配置文件中提供默认配置）
  - 支持通过配置文件切换其他大模型提供商

### 2.2 Out of Scope（本期不包含）
- 源代码级别静态/动态扫描
- 性能监控与 APM
- 成本优化与费用归集

---

## 3. 用户与角色

### 3.1 主要角色
- **企业 IT 管理部门**
  - 目标：统一管理企业工具使用合规性
- **DevOps 工程师**
  - 目标：在 CI/CD 流水线中嵌入工具合规检查
- **安全合规专员**
  - 目标：定期生成可审计的工具合规报告
- **开发团队负责人**
  - 目标：在工具选型阶段评估工具合规风险

---

## 4. 功能需求（Functional Requirements）

### 4.1 工具合规扫描（FR-TOOL-SCAN）
**描述**：用户通过 Web 页面输入**单个工具名或上传工具名列表**，系统基于配置的合规规则与 AI 能力生成合规报告。

- FR-TOOL-SCAN-01：支持单个工具名输入
- FR-TOOL-SCAN-02：支持通过文本框/多行输入提交多个工具名
- FR-TOOL-SCAN-03：支持上传简单文本文件（每行一个工具名）（可选，非 MVP 必须）
- FR-TOOL-SCAN-04：对每个工具执行合规扫描并生成独立结果
- FR-TOOL-SCAN-05：系统能够通过 GLM AI 服务或联网搜索获取和分析工具的 TOS（服务条款）信息，以便更好地识别合规风险

### 4.2 合规报告生成（FR-REPORT）
- FR-REPORT-01：每个工具生成一份结构化报告，包含：
  - 工具名称、工具版本（如可获取）
  - 合规性评分（0–100 或 A/B/C 等级）
  - 合规性建议（文本）
  - 合规性参考（链接或标准名称）
  - 是否合规（是/否）
  - 不合规原因列表
  - 不合规时的**开源替代建议**（包含推荐理由）
- FR-REPORT-02：支持浏览器中查看报告
- FR-REPORT-03：支持导出 JSON 格式（MVP）
- FR-REPORT-04：为后续 HTML/PDF 报告预留接口

### 4.3 合规规则引擎（FR-RULE-ENGINE）
- FR-RULE-ENGINE-01：规则引擎可从配置文件加载合规标准与权重（参考 `config-example.yaml` 的 `compliance` 段）
- FR-RULE-ENGINE-02：规则评估至少覆盖：
  - 安全性（security）
  - 许可证合规（license）
  - 维护性/更新情况（maintenance）
  - 基础性能/稳定性（performance，初期可以弱化）
  - TOS（服务条款）合规性（基于 TOS 信息分析结果）
- FR-RULE-ENGINE-03：评分算法可在配置中调整权重

### 4.4 部署与访问（FR-DEPLOY-ACCESS）
- FR-DEPLOY-01：支持在本地 WSL 环境部署
- FR-DEPLOY-02：支持在主流公有云（阿里云/腾讯云/华为云）使用容器/虚机部署
- FR-DEPLOY-03：MVP 阶段仅支持浏览器访问（`web.access_mode = browser_only`）
- FR-DEPLOY-04：为后续 API 访问预留路由与版本规范（如 `/api/v1/compliance/scan`）

### 4.5 AI 大模型服务（FR-AI）
- FR-AI-01：系统通过配置文件 `config.yaml` 读取 AI 配置（`ai` 段）
- FR-AI-02：默认使用 GLM 官方 Open API：
  - `provider = glm`
  - `glm.api_base = "https://open.bigmodel.cn/api/paas/v4"`
  - `glm.model = "glm-4"`
- FR-AI-03：支持通过配置切换到 OpenAI/Azure/local 等其他 provider
- FR-AI-04：AI 返回结果必须经过规则引擎处理后再对用户展示
- FR-AI-05：系统能够使用 GLM AI 服务或联网搜索功能获取工具的 TOS（服务条款）信息，并进行分析以识别合规风险

---

## 5. 非功能需求（Non-Functional Requirements）

### 5.1 性能
- NFR-PERF-01：单个工具扫描与报告生成时间 < 5 分钟（正常网络与模型延迟下）
- NFR-PERF-02：支持至少 5 个并发扫描请求（可配置）

### 5.2 可用性
- NFR-AVAIL-01：服务可用性目标 > 99.5%（生产环境）

### 5.3 安全
- NFR-SEC-01：不在日志中记录敏感信息（如 API Key、用户隐私）
- NFR-SEC-02：配置文件 `config.yaml` 不提交到 Git 仓库（已在 `.gitignore` 中配置）

### 5.4 可运维性
- NFR-OPS-01：日志输出到文件并支持轮转（参考 `logging` 段）
- NFR-OPS-02：关键指标（请求量、错误率）预留采集点（后续可接入 Prometheus 等）

---

## 6. 工具信息库与数据流

### 6.1 工具信息库（Tool Information Store）
- 系统维护一个**工具信息库**，用于存放“已由用户确认”的工具合规信息（如许可证类型、公司信息、商用限制、替代方案等）。  
- 每次扫描行为遵循以下规则：
  - **首次扫描某工具**：  
    - 始终以本次 AI 分析结果为准生成合规报告；  
    - 只有当用户在界面上明确确认时，才将本次报告写入工具信息库；未确认的报告不入库。  
  - **再次扫描已入库的工具**：  
    - 仍以本次 AI 分析结果为“候选最新真相”；  
    - 将其与工具信息库中的旧记录做差异对比，仅在用户确认的前提下用本次 AI 结果**更新差异字段**；  
    - 如用户选择不更新，则保留原有工具信息库数据，仅将本次扫描结果作为临时参考。  
- 工具信息库支持按工具名字母序浏览、清理过期工具等运维操作。

---

## 7. 数据与接口

### 7.1 主要数据实体
- Tool（工具）
- ComplianceReport（合规报告）
- AlternativeTool（开源替代工具）

### 7.2 外部接口（MVP 展望）
- API-GET `/health`：健康检查
- API-POST `/api/v1/compliance/scan`：提交工具名列表进行扫描（为第二阶段准备）

### 7.3 前端交互说明
- 扫描完成后，每个结果卡片根据报告中的 `knowledge_base_update` 展示工具信息库操作区：新工具可「加入工具信息库」或「暂不保存」；已入库工具可查看差异并「更新差异」或「保持不变」，仅用户确认时调用对应 API，与后端逻辑一致。

---

## 8. 里程碑（Milestones）

1. M1：PRD 与架构文档初版完成
2. M2：MVP 后端服务与 Web 界面开发完成
3. M3：内测与反馈收集
4. M4：迭代优化与 API 能力开放

---

## 9. 附录

- 产品简介：`_bmad-output/planning-artifacts/product-brief.md`
- 用户诉求：`_bmad-output/planning-artifacts/user demand.ini`
- 配置示例：`docs/config-example.yaml`

