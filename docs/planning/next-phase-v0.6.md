# 下一阶段工作规划（v0.6 方向）

> 基于项目 PRD 里程碑、用户诉求与交付自检结论整理  
> 规划日期：按执行日

---

## 1. 当前阶段结论（v0.5）

- **M1**：PRD 与架构文档已完成并随实现更新。
- **M2**：MVP 后端与 Web 界面已就绪：
  - 工具名列表扫描、TOS 分析（含降级）、合规报告生成；
  - 工具信息库：浏览（列表/筛选/详情）、编辑、删除、入库/更新（用户确认）；
  - 报告数据来源标识（本次 AI / 工具信息库 / 混合）；
  - Web 端口可配置，端口占用时有明确提示。
- **用户诉求**：1–5、6（浏览器访问）、7（大模型可配置）已覆盖；6 中“后考虑 API 访问”未做，属下一阶段。

---

## 2. 下一阶段目标（对齐 PRD M3 / M4）

| 目标 | 说明 |
|------|------|
| **M3 内测与反馈** | 固化当前能力、补齐文档与体验，便于内测并收集反馈。 |
| **M4 预备** | 为“迭代优化与 API 能力开放”做准备（接口规范、鉴权预留等）。 |

---

## 3. 建议工作项（按优先级）

### P0：内测可用性与健壮性

1. **无配置文件时的启动与扫描**
   - **问题**：其它机器未创建 `config/config.yaml` 时，`config.ai.glm` 为 `None`，触发 `'NoneType' object has no attribute 'api_base'`。
   - **建议**：在默认配置下为 `AIConfig.glm` 提供默认实例（如 `Field(default_factory=GLMConfig)`），使服务可正常启动；未配置 API Key 时 AI 调用返回 None，扫描可回退工具信息库或空结果，并保留“请配置 GLM API Key”类提示。
2. **首次运行指引**
   - 在 README 或 run.bat 输出中强调：首次使用需复制 `docs/config-example.yaml` 为 `config/config.yaml` 并填写 `ai.glm.api_key`，否则扫描仅能使用工具信息库数据。

### P1：文档与需求对齐（支撑 M3）

3. **PRD 与实现表述一致**
   - 修订 **FR-REPORT-01**：与当前报告结构对齐（使用许可、公司信息、商用限制、可替代方案、工具信息库更新建议、data_source），保留“合规性评分/建议/参考”为可选或后续扩展。
   - 视需要微调 **FR-RULE-ENGINE** 描述，使其与当前“多维度评分 + TOS 分析”的实现一致。
4. **部署与运行说明**
   - 在 README 或单独部署文档中明确：本地 WSL、公有云（阿里云/腾讯云/华为云）的推荐部署方式；端口、环境变量、config 路径的说明。

### P2：产品与运维体验（M3 内测体验）

5. **工具信息库“定期清理”**
   - 用户诉求 5：“定期清理过期工具”。当前已有单条删除。
   - 可选：在工具信息库浏览中增加“按更新时间排序/筛选”，或提供“过期”标记规则（如超过 N 天未更新），为后续批量清理或导出做准备。
6. **报告导出与留存**
   - 当前支持 JSON 结构；若内测需要，可增加“单次报告下载为 JSON 文件”或报告列表与历史查看（在现有 API 上扩展即可）。

### P3：M4 预备（API 与开放能力）

7. **扫描与报告 API 规范化**
   - PRD 7.2：预留 `POST /api/v1/compliance/scan`。当前已有 `POST /api/v1/tools/batch` + `POST /api/v1/scan/start` 等。
   - 下一阶段可二选一：**A)** 增加一层聚合接口 `POST /api/v1/compliance/scan`（接收工具名列表，内部调 batch+start，返回 task_id/报告 ID 等）；**B)** 在现有接口上补充 OpenAPI 描述与示例，便于外部调用。
8. **鉴权预留**
   - 架构与 PRD：对外 API 需预留鉴权（Token/API Key），MVP 可不开启。
   - 在 FastAPI 中预留依赖项（如验证 Header 中的 API Key），默认关闭，由配置开关控制。

---

## 4. 不建议本阶段做的（保持范围）

- 源代码级静态/动态扫描（PRD Out of Scope）
- 性能监控/APM、成本归集（Out of Scope）
- 微服务拆分、消息队列、Prometheus/Grafana（架构“后续演进”，非本阶段必选）

---

## 5. 执行顺序建议

1. **先做 P0**：无配置时默认 `glm` 实例 + 首次运行指引，保证任意环境 run.bat 不因 None 崩溃。
2. **再做 P1**：PRD 修订与部署文档，支撑 M3 评审与内测说明。
3. **按需做 P2**：工具信息库排序/筛选或“过期”概念、报告下载，视内测反馈决定优先级。
4. **M3 收尾后启动 P3**：API 聚合或规范化、鉴权预留，为 M4 迭代优化与 API 开放做准备。

---

## 6. 产出物（本阶段可交付）

- 配置与启动：无配置文件时服务可正常启动且扫描不报 NoneType；README/run 提示完善。
- 文档：PRD 中 FR-REPORT-01（及视情 FR-RULE-ENGINE）与实现对齐；部署与运行说明更新。
- 可选：工具信息库列表按更新时间排序或简单筛选；单次报告 JSON 下载。
- M4 预备：扫描 API 设计或实现（聚合接口或文档化现有接口）；鉴权开关与预留实现。

以上规划可与实际排期和人力结合后裁剪或拆分为迭代任务。
